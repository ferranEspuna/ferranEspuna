---
layout: default
title: My New Subsection
---

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Newton's Fractal Shader</title>

  <!-- These headers make fetch() reliable in private browsing -->
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    
</head>
<body>

  <nav>
    <a href="../index.html">&larr; Back to ferran.info</a>
  </nav>

  <h2>Newton's Fractal</h2>

  <div class="shader-window">
    <canvas class="glslCanvas" data-fragment-url="shader.frag" width="600" height="600"></canvas>
  </div>

  <div class="controls">
    <label for="iterSlider">Iterations:</label>
    <input type="range" id="iterSlider" min="0" max="30" value="5">
    <span id="iterValue">5</span>
  </div>

  <script type="module">
  import GlslCanvas from "https://cdn.jsdelivr.net/npm/glsl-canvas-js@0.2.9/+esm";
  
  window.addEventListener("load", async () => {
    const canvas = document.querySelector(".glslCanvas");
    const slider = document.getElementById("iterSlider");
    const iterDisplay = document.getElementById("iterValue");
  
    const sandbox = new GlslCanvas(canvas);
  
    const fragUrl = canvas.getAttribute("data-fragment-url");
    const fragShader = await (await fetch(fragUrl)).text();
    sandbox.load(fragShader);
  
    // Initial uniform
    sandbox.setUniform("u_iterations", parseInt(slider.value, 10));
  
    // Update iterations from slider
    slider.addEventListener("input", () => {
      const iterations = parseInt(slider.value, 10);
      sandbox.setUniform("u_iterations", iterations);
      iterDisplay.textContent = iterations;
    });
  
    // --- FIXED MOUSE HANDLING ---
    canvas.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = rect.height - (e.clientY - rect.top); // Flip Y-axis
      sandbox.setUniform("u_mouse", [x, y]);
    });
  });
  </script>


</body>
</html>
